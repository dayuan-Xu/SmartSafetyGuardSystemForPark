# 项目数据库设计文档

## 概述
本项目数据库主要用于存储与告警相关的信息，包括告警记录、告警处理记录、用户信息以及摄像头信息。以下是各数据表的详细设计。

## 数据表设计

### 1. 用户表（user）
用于存储系统用户的基本信息，包括用户ID、用户名、密码、角色等。

| 字段名 | 数据类型 | 约束 | 说明 |
| ---- | ---- | ---- | ---- |
| user_id | Integer | 主键、自增、索引 | 用户唯一标识 |
| user_name | String(64) | 非空、唯一 | 用户名 |
| password | String(128) | 非空 | 加密后的密码 |
| user_role | Integer | 默认3 | 角色：0-管理员、1-安保管理员、2-普通操作员 |
| create_time | DateTime | 默认当前UTC时间 | 记录创建时间 |
| update_time | DateTime | 默认当前UTC时间，更新时自动更新 | 记录更新时间 |

### 2. 摄像头信息表（camera_info）
存储摄像头的基本信息，包括所属区域、安装位置、RTSP地址等。

| 字段名 | 数据类型 | 约束 | 说明 |
| ---- | ---- | ---- | ---- |
| camera_id | Integer | 主键、自增、索引 | 摄像头唯一标识 |
| camera_name | String(64) | 非空 | 摄像头名称 |
| park_area | String(64) | 非空 | 摄像头所属园区区域 |
| install_position | String(64) | 非空 | 摄像头具体安装位置 |
| rtsp_url | String(255) | 非空 | 摄像头的RTSP地址 |
| analysis_mode | Integer | 非空 | 分析模式：0-无，1-全部，2-安全规范，3-区域入侵，4-火警 |
| camera_status | Integer | 默认0 | 摄像头状态：0-离线，1-在线 |
| create_time | DateTime | 默认当前UTC时间 | 记录创建时间 |
| update_time | DateTime | 默认当前UTC时间，更新时自动更新 | 记录更新时间 |

### 3. 告警主表（alarm）
记录告警的基本信息，包括告警ID、关联的摄像头、告警类型、状态等。

| 字段名 | 数据类型 | 约束 | 说明 |
| ---- | ---- | ---- | ---- |
| alarm_id | BigInteger | 主键、自增、索引 | 告警唯一标识 |
| camera_id | Integer | 非空、索引 | 关联的摄像头ID（逻辑外键） |
| alarm_type | Integer | 非空 | 告警类型：0-安全规范（未戴安全帽/未穿反光衣）、2-区域入侵（人/车）、3-火警（火焰/烟雾） |
| alarm_status | Integer | 默认0 | 告警状态：0-未处理、1-确认误报、2-处理中（已派单）、3-处理完成 |
| alarm_time | DateTime | 非空 | 告警触发时间 |
| snapshot_url | String(255) | 非空 | 报警截图URL |
| video_clip_url | String(255) | 非空 | 报警视频片段URL |
| create_time | DateTime | 默认当前UTC时间 | 记录创建时间 |
| update_time | DateTime | 默认当前UTC时间，更新时自动更新 | 记录更新时间 |

### 4. 告警处理记录表（alarm_handle_record）
记录告警的处理情况，包括处理人、处理动作、处理内容等。

| 字段名 | 数据类型 | 约束 | 说明 |
| ---- | ---- | ---- | ---- |
| handle_id | BigInteger | 主键、自增、索引 | 处理记录唯一标识 |
| alarm_id | BigInteger | 非空、索引 | 关联的告警ID（逻辑外键） |
| handle_time | DateTime | 非空、默认当前UTC时间 | 处理时间 |
| handler_user_id | Integer | 非空 | 处理人ID（系统用户，逻辑外键） |
| handle_action | Integer | 非空 | 处理动作：0-标记误报，1-派单处理，2-标记已解决 |
| handle_content | Text | 可为空 | 处理详情（如派单对象、解决措施），派单时前端自动生成 |
| handle_attachment_url | String(255) | 可为空 | 标记已解决时上传的附件路径（如现场反馈照片） |
| create_time | DateTime | 默认当前UTC时间 | 记录创建时间 |
| update_time | DateTime | 默认当前UTC时间，更新时自动更新 | 记录更新时间 |

## 表关系说明
- `alarm` 表通过 `camera_id` 与 `camera_info` 表关联，一个摄像头可产生多条告警记录。
- `alarm_handle_record` 表通过 `alarm_id` 与 `alarm` 表关联，一条告警可有多条处理记录。
- `alarm_handle_record` 表通过 `handler_user_id` 与 `user` 表关联，一个用户可处理多条告警记录。