# 基于YOLO模型的园区安全规范监测系统概要设计（MVP版）
## 一、后端技术栈选择（MVP适配原则）
优先选择**轻量、易上手、生态成熟**的技术，减少开发复杂度，快速实现核心功能，技术栈选择如下表所示：

| 技术类别 | 选型                           | 选型依据（MVP核心诉求） |
|----------|------------------------------|--------------------------|
| 后端框架 | FastAPI                      | 1. 高性能异步特性，适配实时告警推送与视频流处理场景；2. 自动生成API文档（Swagger UI），降低前后端联调成本；3. 代码简洁，开发效率高于Django，符合MVP快速迭代需求 |
| 模型集成 | Ultralytics YOLOv11 + OpenCV | 1. Ultralytics框架封装完善，支持直接调用预训练模型，可快速实现“安全帽/反光衣/火焰/烟雾”核心检测功能；2. OpenCV轻量，便于抓取RTSP摄像头流，无需复杂视频处理组件 |
| 实时通信 | WebSocket（FastAPI内置）         | 1. FastAPI原生支持WebSocket，无需额外集成第三方库，降低技术复杂度；2. 满足“后端主动向前端推送实时告警”核心需求，延迟低 |
| 数据存储 | MySQL + Redis                | 1. MySQL支持结构化数据存储，适配告警记录、摄像头信息等核心表设计；2. Redis用于缓存高频访问数据（如在线摄像头状态、未处理告警数），提升查询效率，且部署运维简单 |
| 部署方式 | 本地化Docker部署                  | 1. Docker打包前后端、模型服务，简化客户侧部署流程（符合MVP“易落地”需求）；2. 暂不支持云端部署，减少运维与适配成本，聚焦核心功能验证 |


## 二、后端功能模块划分（MVP核心聚焦）
按“**先实现核心监测与告警，再补充基础配置与统计**”的原则，划分5个核心模块，剔除非必要功能（如复杂报表导出、多租户权限）：

| 模块名称 | 核心功能（MVP范围） | 非MVP功能（暂不开发） |
|----------|----------------------|------------------------|
| 1. 视频流采集与模型推理模块 | 1. 拉取指定摄像头RTSP流（基于OpenCV）；2. 调用YOLOv8模型实时检测“未戴安全帽、未穿反光衣、火焰、烟雾、危险区域入侵”5类场景；3. 检测到异常时触发告警（生成截图、标记告警类型/时间） | 1. 视频流录制与回放；2. 模型动态迭代与版本管理；3. 复杂环境（逆光、遮挡）适配优化 |
| 2. 告警管理模块 | 1. 告警数据写入MySQL（关联摄像头ID、截图URL）；2. 支持“未处理→处理中→已解决/误报”状态更新；3. 通过WebSocket推送实时告警到前端 | 1. 告警分级推送（短信/邮件通知）；2. 告警批量处理与规则配置；3. 误报原因统计分析 |
| 3. 摄像头管理模块 | 1. 摄像头基础信息CRUD（ID、名称、RTSP地址、所属区域、在线状态）；2. 摄像头在线/离线状态检测（定时ping RTSP地址）；3. 缓存在线摄像头状态到Redis | 1. 摄像头分组管理；2. 视频流码率自适应调整；3. 摄像头故障自动报修 |
| 4. 用户与权限模块 | 1. 基础用户CRUD（用户名、密码、角色：管理员/操作员）；2. 简单权限控制（管理员可修改配置，操作员仅查看告警/处理告警）；3. 密码加密存储（基于bcrypt） | 1. 多租户权限隔离；2. 操作日志审计；3. 第三方账号集成（如企业微信登录） |
| 5. 数据缓存模块 | 1. Redis缓存“未处理告警数”“在线摄像头列表”“用户登录Token”；2. 缓存数据定时刷新（未处理告警数每10秒更新） | 1. 历史告警数据缓存；2. 缓存集群与容灾；3. 热点数据自动预热 |


## 三、开发顺序（MVP迭代节奏）
按“**依赖前置、功能闭环**”原则，分4个阶段开发，每个阶段验证1-2个核心场景，确保快速落地可用：

### 阶段1：基础环境搭建与核心依赖验证（1周，对应研发计划第3周）
**目标**：打通“摄像头流→模型推理→数据存储”基础链路，无前端交互。  
1. 搭建FastAPI项目框架，集成MySQL（创建核心表：alarm、camera_info、user、alarm_handle_record）、Redis；  
2. 实现“视频流采集+模型推理”最小demo：拉取1个测试摄像头RTSP流，调用YOLOv8预训练模型检测安全帽，输出检测结果；  
3. 验证数据写入：检测到异常时，生成截图并存储到本地路径，同时将告警信息写入alarm_main表。  

**交付物**：可运行的后端demo（命令行输出检测结果，MySQL可查告警数据）。


### 阶段2：核心功能开发（2周，对应研发计划第4-5周）
**目标**：实现“实时告警推送+基础配置”，支持前端简单交互。  
1. 完成“摄像头管理模块”：实现摄像头CRUD API，支持添加/删除摄像头，检测在线状态并缓存到Redis；  
2. 完善“模型推理模块”：支持5类告警场景检测，优化推理速度（确保单摄像头检测延迟≤500ms）；  
3. 开发“告警管理模块”：实现告警状态更新API，集成WebSocket推送实时告警（前端连接后可接收告警信息）；  
4. 完成“用户与权限模块”：实现用户登录（生成Token）、基础权限控制（管理员可修改摄像头配置）。  

**交付物**：后端API文档（Swagger UI）、实时告警推送功能（可通过Postman模拟前端接收）。


### 阶段3：前后端联调与功能闭环（1.5周，对应研发计划第6周）
**目标**：配合前端完成“可视化看板+告警处理”，形成完整业务闭环。  
1. 联调“摄像头列表”：前端展示摄像头信息、在线状态，支持添加/编辑摄像头；  
2. 联调“实时告警看板”：前端通过WebSocket接收告警，展示告警列表（含截图、时间、摄像头）；  
3. 联调“告警处理”：前端支持更新告警状态（如标记为“已解决”），后端同步更新MySQL数据；  

**交付物**：可运行的前后端联调版本（支持“摄像头配置→实时监测→告警查看→状态更新”全流程）。


### 阶段4：测试与优化（0.5周，对应研发计划第7周）
**目标**：修复核心bug，确保MVP版本稳定可用。  
1. 黑盒测试：验证核心场景（如添加摄像头后是否能检测、告警状态更新是否同步、WebSocket推送是否稳定）；  
2. 性能优化：优化Redis缓存策略（如未处理告警数缓存更新频率），减少MySQL查询压力；  

**交付物**：MVP版本测试报告。
